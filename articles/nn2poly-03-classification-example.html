<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Classification example using tensorflow • nn2poly</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Classification example using tensorflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nn2poly</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/nn2poly-01-introduction.html">Introduction to nn2poly</a></li>
    <li><a class="dropdown-item" href="../articles/nn2poly-02-supported-DL-frameworks.html">Supported DL frameworks</a></li>
    <li><a class="dropdown-item" href="../articles/nn2poly-03-classification-example.html">Classification example using tensorflow</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Classification example using tensorflow</h1>
                        <h4 data-toc-skip class="author">Pablo
Morala</h4>
            
            <h4 data-toc-skip class="date">2024-01-17</h4>
      

      <div class="d-none name"><code>nn2poly-03-classification-example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="multiclass-classification-example">Multiclass classification example<a class="anchor" aria-label="anchor" href="#multiclass-classification-example"></a>
</h2>
<p>After showing how to use <code>nn2poly</code> in a regression setting
both in <code><a href="../articles/nn2poly-01-introduction.html">vignette("nn2poly-01-introduction")</a></code> and
<code><a href="../articles/nn2poly-02-supported-DL-frameworks.html">vignette("nn2poly-02-supported-DL-frameworks")</a></code>, we will see
here a multiclass classification example using the iris dataset to
showcase how nn2poly obtains a polynomial for each class (or output
neuron).</p>
<p>In order to train our model we will use in this case the
<code>keras</code>/<code>tensorflow</code> framework, and we will
benefit from the provided support for it in <code>nn2poly</code> as we
saw in <code><a href="../articles/nn2poly-02-supported-DL-frameworks.html">vignette("nn2poly-02-supported-DL-frameworks")</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ibidat.github.io/nn2poly/">nn2poly</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tensorflow.rstudio.com/" class="external-link">keras</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This sets all needed seeds</span></span>
<span><span class="fu">tensorflow</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tensorflow/man/set_random_seed.html" class="external-link">set_random_seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<p>First we load the <code>iris</code> dataset and scale the data to the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mo>−</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[-1,1]</annotation></semantics></math>
interval:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Change response to numeric. In this case, Species was already numeric,</span></span>
<span><span class="co"># but this step is needed if it is a factor variable.</span></span>
<span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define dimension p (number of predictor variables)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Define objective classes</span></span>
<span><span class="va">n_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>,<span class="op">(</span><span class="va">p</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Move objective classes from (1:3) to (0:2), needed for tensorflow</span></span>
<span><span class="va">iris</span><span class="op">[</span>,<span class="op">(</span><span class="va">p</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span>,<span class="op">(</span><span class="va">p</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scale the data in the [-1,1] interval and separate train and test</span></span>
<span><span class="co"># Only the predictor variables are scaled, not the response as those will be</span></span>
<span><span class="co"># the different classes.</span></span>
<span><span class="va">iris_x</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="va">p</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">maxs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">iris_x</span>, <span class="fl">2</span>, <span class="va">max</span><span class="op">)</span></span>
<span><span class="va">mins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">iris_x</span>, <span class="fl">2</span>, <span class="va">min</span><span class="op">)</span></span>
<span><span class="va">data_x_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">iris_x</span>, center <span class="op">=</span> <span class="va">mins</span> <span class="op">+</span> <span class="op">(</span><span class="va">maxs</span> <span class="op">-</span> <span class="va">mins</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>, scale <span class="op">=</span> <span class="op">(</span><span class="va">maxs</span> <span class="op">-</span> <span class="va">mins</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data_x_scaled</span>, <span class="va">iris</span><span class="op">[</span>,<span class="op">(</span><span class="va">p</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Divide in train (0.75) and test (0.25)</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">0.75</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">index</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="op">-</span><span class="va">index</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="va">p</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">train_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train</span><span class="op">[</span>,<span class="op">(</span><span class="va">p</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="va">p</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">test_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span>,<span class="op">(</span><span class="va">p</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="neural-network">Neural network<a class="anchor" aria-label="anchor" href="#neural-network"></a>
</h3>
<p>In this section we will create and train (imposing weight
constraints) our original neural network that will be later explained by
<code><a href="../reference/nn2poly.html">nn2poly()</a></code>.</p>
<div class="section level4">
<h4 id="build-and-train-the-nn">Build and train the NN<a class="anchor" aria-label="anchor" href="#build-and-train-the-nn"></a>
</h4>
<p>First, we build the model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">keras_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">tensorflow</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tensorflow/man/set_random_seed.html" class="external-link">set_random_seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html" class="external-link">keras_model_sequential</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span><span class="va">nn</span>, units <span class="op">=</span> <span class="fl">100</span>, activation <span class="op">=</span> <span class="st">"tanh"</span>, input_shape <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span>  <span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span><span class="va">nn</span>, units <span class="op">=</span> <span class="fl">100</span>, activation <span class="op">=</span> <span class="st">"tanh"</span><span class="op">)</span></span>
<span>  <span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html" class="external-link">layer_dense</a></span><span class="op">(</span><span class="va">nn</span>, units <span class="op">=</span> <span class="va">n_class</span>, activation <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">nn</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model.html" class="external-link">keras_model</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Impose weight constraints provided by nn2poly package</span></span>
<span><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_constraints.html">add_constraints</a></span><span class="op">(</span><span class="va">nn</span>, constraint_type <span class="op">=</span> <span class="st">"l1_norm"</span><span class="op">)</span></span>
<span><span class="va">nn</span></span>
<span><span class="co">#&gt; Model: "sequential"</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span><span class="co">#&gt;  Layer (type)                       Output Shape                    Param #     </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt;  dense (Dense)                      (None, 100)                     500         </span></span>
<span><span class="co">#&gt;  dense_1 (Dense)                    (None, 100)                     10100       </span></span>
<span><span class="co">#&gt;  dense_2 (Dense)                    (None, 3)                       303         </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; Total params: 10903 (42.59 KB)</span></span>
<span><span class="co">#&gt; Trainable params: 10903 (42.59 KB)</span></span>
<span><span class="co">#&gt; Non-trainable params: 0 (0.00 Byte)</span></span>
<span><span class="co">#&gt; ________________________________________________________________________________</span></span></code></pre></div>
<blockquote>
<p><em>Note</em>: In this case the NN has a <em>linear</em> output with
the same number of neurons as the number of classes to predict (3
species, <code>n_class</code>). Then, the linear output will be
transformed into a <em>probability</em> to find the most probable class
but this step is done <em>after training</em>. Therefore, nn2poly will
be used to obtain a polynomial that approximates this <em>nn with linear
outputs</em> and then its results will also be transformed in
probabilities to predict the highest probability class.</p>
</blockquote>
<p>Then we compile and train the model, using a categorical crossentropy
loss and accuracy as the chosen metric.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile</a></span><span class="op">(</span><span class="va">nn</span>,</span>
<span>        loss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/loss-functions.html" class="external-link">loss_sparse_categorical_crossentropy</a></span><span class="op">(</span>from_logits <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        optimizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/optimizer_adam.html" class="external-link">optimizer_adam</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        metrics <span class="op">=</span> <span class="st">"accuracy"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">history</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">nn</span>,</span>
<span>               <span class="va">train_x</span>,</span>
<span>               <span class="va">train_y</span>,</span>
<span>               verbose <span class="op">=</span> <span class="fl">0</span>,</span>
<span>               epochs <span class="op">=</span> <span class="fl">200</span>,</span>
<span>               validation_split <span class="op">=</span> <span class="fl">0.3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">history</span><span class="op">)</span></span></code></pre></div>
<p><img src="includes%2Fnn2poly-03-class-nn-compile-1.png"></p>
</div>
<div class="section level4">
<h4 id="nn-predictions">NN Predictions<a class="anchor" aria-label="anchor" href="#nn-predictions"></a>
</h4>
<p>In this case, to asses the NNs accuracy we have to transform their
output into a probability, which we will do by using
<code><a href="https://rdrr.io/pkg/keras/man/layer_activation_softmax.html" class="external-link">layer_activation_softmax()</a></code> and then choosing the class with
highest probability with <code>k_argmax</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the model probability model using our previously trained nn</span></span>
<span><span class="va">probability_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html" class="external-link">keras_model_sequential</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">nn</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_activation_softmax.html" class="external-link">layer_activation_softmax</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_lambda.html" class="external-link">layer_lambda</a></span><span class="op">(</span><span class="va">k_argmax</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Obtain the predicted classes with the NN to compare them</span></span>
<span><span class="va">prediction_NN_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">probability_model</span>, <span class="va">test_x</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2/2 - 0s - 70ms/epoch - 35ms/step</span></span></code></pre></div>
<blockquote>
<p><em>Note</em>: As said before, <code><a href="../reference/nn2poly.html">nn2poly()</a></code> will
approximate the linear output of the neural network, so we will need to
perform these transformation also in the polynomial predictions to
obtain a classification response.</p>
</blockquote>
<p>We can also compute the linear output of the model (before converting
it to a probability) and store it to compare with the polynomial output
later.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Also, the linear output can be predicted before the probability model</span></span>
<span><span class="va">prediction_NN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">nn</span>, <span class="va">test_x</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2/2 - 0s - 40ms/epoch - 20ms/step</span></span></code></pre></div>
<p>Finally We can use here a confusion matrix to visualize the results,
where we can see that that the NN correctly predicts almost all of the
classes in the test data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a confusion matrix</span></span>
<span><span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu">confusionMatrix</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">prediction_NN_class</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">test_y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cm</span></span>
<span><span class="co">#&gt; Confusion Matrix and Statistics</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           Reference</span></span>
<span><span class="co">#&gt; Prediction  0  1  2</span></span>
<span><span class="co">#&gt;          0 11  0  0</span></span>
<span><span class="co">#&gt;          1  0 11  1</span></span>
<span><span class="co">#&gt;          2  0  1 14</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall Statistics</span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;                Accuracy : 0.9474          </span></span>
<span><span class="co">#&gt;                  95% CI : (0.8225, 0.9936)</span></span>
<span><span class="co">#&gt;     No Information Rate : 0.3947          </span></span>
<span><span class="co">#&gt;     P-Value [Acc &gt; NIR] : 7.82e-13        </span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;                   Kappa : 0.9203          </span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;  Mcnemar's Test P-Value : NA              </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Statistics by Class:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                      Class: 0 Class: 1 Class: 2</span></span>
<span><span class="co">#&gt; Sensitivity            1.0000   0.9167   0.9333</span></span>
<span><span class="co">#&gt; Specificity            1.0000   0.9615   0.9565</span></span>
<span><span class="co">#&gt; Pos Pred Value         1.0000   0.9167   0.9333</span></span>
<span><span class="co">#&gt; Neg Pred Value         1.0000   0.9615   0.9565</span></span>
<span><span class="co">#&gt; Prevalence             0.2895   0.3158   0.3947</span></span>
<span><span class="co">#&gt; Detection Rate         0.2895   0.2895   0.3684</span></span>
<span><span class="co">#&gt; Detection Prevalence   0.2895   0.3158   0.3947</span></span>
<span><span class="co">#&gt; Balanced Accuracy      1.0000   0.9391   0.9449</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="polynomial-representation">Polynomial representation<a class="anchor" aria-label="anchor" href="#polynomial-representation"></a>
</h3>
<div class="section level4">
<h4 id="using-nn2poly">Using <code>nn2poly</code><a class="anchor" aria-label="anchor" href="#using-nn2poly"></a>
</h4>
<p>After the NN has been trained, we can directly call
<code><a href="../reference/nn2poly.html">nn2poly()</a></code> on the model, where we only need to choose the
value <code>max_order</code> which will limit the order of the computed
coefficients in the final polynomial. In this case we will set it as
<code>3</code>.</p>
<p>Note that in this case, as we have 3 output neurons, there will be 3
output polynomials. The polynomials will be stored in the same way as in
the regression case, in a list with labels and values, but in this case
the values will be a matrix with 3 rows, where each row will be the
polynomial obtained for each output neuron.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Polynomial for nn</span></span>
<span><span class="va">final_poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nn2poly.html">nn2poly</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">nn</span>,</span>
<span>                      max_order <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">final_poly</span></span>
<span><span class="co">#&gt; $labels</span></span>
<span><span class="co">#&gt; $labels[[1]]</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[2]]</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[3]]</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[4]]</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[5]]</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[6]]</span></span>
<span><span class="co">#&gt; [1] 1 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[7]]</span></span>
<span><span class="co">#&gt; [1] 1 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[8]]</span></span>
<span><span class="co">#&gt; [1] 1 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[9]]</span></span>
<span><span class="co">#&gt; [1] 1 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[10]]</span></span>
<span><span class="co">#&gt; [1] 2 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[11]]</span></span>
<span><span class="co">#&gt; [1] 2 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[12]]</span></span>
<span><span class="co">#&gt; [1] 2 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[13]]</span></span>
<span><span class="co">#&gt; [1] 3 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[14]]</span></span>
<span><span class="co">#&gt; [1] 3 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[15]]</span></span>
<span><span class="co">#&gt; [1] 4 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[16]]</span></span>
<span><span class="co">#&gt; [1] 1 1 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[17]]</span></span>
<span><span class="co">#&gt; [1] 1 1 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[18]]</span></span>
<span><span class="co">#&gt; [1] 1 1 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[19]]</span></span>
<span><span class="co">#&gt; [1] 1 1 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[20]]</span></span>
<span><span class="co">#&gt; [1] 1 2 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[21]]</span></span>
<span><span class="co">#&gt; [1] 1 2 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[22]]</span></span>
<span><span class="co">#&gt; [1] 1 2 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[23]]</span></span>
<span><span class="co">#&gt; [1] 1 3 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[24]]</span></span>
<span><span class="co">#&gt; [1] 1 3 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[25]]</span></span>
<span><span class="co">#&gt; [1] 1 4 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[26]]</span></span>
<span><span class="co">#&gt; [1] 2 2 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[27]]</span></span>
<span><span class="co">#&gt; [1] 2 2 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[28]]</span></span>
<span><span class="co">#&gt; [1] 2 2 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[29]]</span></span>
<span><span class="co">#&gt; [1] 2 3 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[30]]</span></span>
<span><span class="co">#&gt; [1] 2 3 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[31]]</span></span>
<span><span class="co">#&gt; [1] 2 4 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[32]]</span></span>
<span><span class="co">#&gt; [1] 3 3 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[33]]</span></span>
<span><span class="co">#&gt; [1] 3 3 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[34]]</span></span>
<span><span class="co">#&gt; [1] 3 4 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $labels[[35]]</span></span>
<span><span class="co">#&gt; [1] 4 4 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $values</span></span>
<span><span class="co">#&gt;              [,1]         [,2]         [,3]</span></span>
<span><span class="co">#&gt;  [1,]  0.04067109  2.838697004 -2.366766912</span></span>
<span><span class="co">#&gt;  [2,] -1.01692952  0.922284435  0.306762048</span></span>
<span><span class="co">#&gt;  [3,]  3.82618130 -1.532152815 -2.683000514</span></span>
<span><span class="co">#&gt;  [4,] -4.86343269 -0.367029700  5.201883882</span></span>
<span><span class="co">#&gt;  [5,] -6.05908248 -2.026009803  7.701675045</span></span>
<span><span class="co">#&gt;  [6,]  0.02216647 -0.068650500  0.031318449</span></span>
<span><span class="co">#&gt;  [7,] -0.09821698  0.115922745  0.007638440</span></span>
<span><span class="co">#&gt;  [8,]  0.08146315 -0.072443601 -0.025525980</span></span>
<span><span class="co">#&gt;  [9,]  0.04337399 -0.019371395 -0.029198248</span></span>
<span><span class="co">#&gt; [10,]  0.08763212 -0.122314949  0.007196786</span></span>
<span><span class="co">#&gt; [11,] -0.13090934  0.160297202  0.008898167</span></span>
<span><span class="co">#&gt; [12,] -0.03982065  0.118363240 -0.047742059</span></span>
<span><span class="co">#&gt; [13,] -0.03990296 -0.186114002  0.182448046</span></span>
<span><span class="co">#&gt; [14,] -0.22518863 -0.383706458  0.517483976</span></span>
<span><span class="co">#&gt; [15,] -0.21539519 -0.340739130  0.476053215</span></span>
<span><span class="co">#&gt; [16,]  0.01640856 -0.015861053 -0.004179781</span></span>
<span><span class="co">#&gt; [17,] -0.08649215  0.054035395  0.045407899</span></span>
<span><span class="co">#&gt; [18,]  0.08657797 -0.020808458 -0.071458194</span></span>
<span><span class="co">#&gt; [19,]  0.10626455  0.016833308 -0.120917295</span></span>
<span><span class="co">#&gt; [20,] -0.09226002  0.058721711  0.047211597</span></span>
<span><span class="co">#&gt; [21,] -0.12782353  0.099224893  0.053681832</span></span>
<span><span class="co">#&gt; [22,] -0.14300636  0.061378209  0.099556359</span></span>
<span><span class="co">#&gt; [23,]  0.08681554 -0.019495659 -0.072698532</span></span>
<span><span class="co">#&gt; [24,]  0.07906020 -0.071096510 -0.027609755</span></span>
<span><span class="co">#&gt; [25,]  0.10751970  0.019949727 -0.124596164</span></span>
<span><span class="co">#&gt; [26,] -0.12832404  0.057077780  0.086244551</span></span>
<span><span class="co">#&gt; [27,]  0.31410761 -0.112571487 -0.233324113</span></span>
<span><span class="co">#&gt; [28,]  0.39822386 -0.072171099 -0.351003640</span></span>
<span><span class="co">#&gt; [29,]  0.32366110 -0.115551628 -0.240170974</span></span>
<span><span class="co">#&gt; [30,] -0.64179985  0.150429244  0.539640723</span></span>
<span><span class="co">#&gt; [31,]  0.40593582 -0.069258417 -0.360602426</span></span>
<span><span class="co">#&gt; [32,]  0.17561230  0.009076263 -0.185280705</span></span>
<span><span class="co">#&gt; [33,]  0.51767960  0.109300583 -0.609898697</span></span>
<span><span class="co">#&gt; [34,]  0.51398607  0.101899652 -0.600694175</span></span>
<span><span class="co">#&gt; [35,]  0.34526975  0.146409617 -0.461815984</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "nn2poly"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="obtaining-polynomial-predictions">Obtaining polynomial predictions<a class="anchor" aria-label="anchor" href="#obtaining-polynomial-predictions"></a>
</h4>
<p>As said before, the obtained polynomial represents the neural network
before including the softmax function and computing the class assigned
to each observation. Then, we need to define again a keras sequential
model that includes the class computation from the polynomial output.
This polynomial output is obtained with <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> used on
the <code><a href="../reference/nn2poly.html">nn2poly()</a></code> output, in this case in matrix form, as the 3
polynomials are evaluated at the same time:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Obtain the predicted values for the test data with our Polynomial Regression</span></span>
<span><span class="va">prediction_poly_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">final_poly</span>, newdata <span class="op">=</span> <span class="va">test_x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define probability model with keras for the polynomial outputs</span></span>
<span><span class="va">probability_poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html" class="external-link">keras_model_sequential</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_activation_softmax.html" class="external-link">layer_activation_softmax</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_lambda.html" class="external-link">layer_lambda</a></span><span class="op">(</span><span class="va">k_argmax</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Class prediction with the polynomial outputs</span></span>
<span><span class="va">prediction_poly_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">probability_poly</span>,</span>
<span>                                 <span class="va">prediction_poly_matrix</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2/2 - 0s - 121ms/epoch - 60ms/step</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="visualizing-the-results">Visualizing the results<a class="anchor" aria-label="anchor" href="#visualizing-the-results"></a>
</h4>
<p>With the polynomial predictions, there are two options. We can
represent in a diagonal line the linear outputs obtained directly from
the polynomial and NN predictions, or compare the assigned classes after
employing the probability models. Please note here that we compare the
predictions (linear and classes) of the polynomials with the NN
predictions and not the original data, as <code>nn2poly</code>’s goal is
to faithfully represent the NN behavior independently of how well the NN
predicts.</p>
<p>First, let’s observe the confusion matrix for the assigned
classes:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Confussion matrix between NN class prediction and polynomial class prediction</span></span>
<span><span class="va">cm_poly</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu">confusionMatrix</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">prediction_NN_class</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">prediction_poly_class</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cm_poly</span></span>
<span><span class="co">#&gt; Confusion Matrix and Statistics</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           Reference</span></span>
<span><span class="co">#&gt; Prediction  0  1  2</span></span>
<span><span class="co">#&gt;          0 11  0  0</span></span>
<span><span class="co">#&gt;          1  0 12  0</span></span>
<span><span class="co">#&gt;          2  0  0 15</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall Statistics</span></span>
<span><span class="co">#&gt;                                      </span></span>
<span><span class="co">#&gt;                Accuracy : 1          </span></span>
<span><span class="co">#&gt;                  95% CI : (0.9075, 1)</span></span>
<span><span class="co">#&gt;     No Information Rate : 0.3947     </span></span>
<span><span class="co">#&gt;     P-Value [Acc &gt; NIR] : 4.568e-16  </span></span>
<span><span class="co">#&gt;                                      </span></span>
<span><span class="co">#&gt;                   Kappa : 1          </span></span>
<span><span class="co">#&gt;                                      </span></span>
<span><span class="co">#&gt;  Mcnemar's Test P-Value : NA         </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Statistics by Class:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                      Class: 0 Class: 1 Class: 2</span></span>
<span><span class="co">#&gt; Sensitivity            1.0000   1.0000   1.0000</span></span>
<span><span class="co">#&gt; Specificity            1.0000   1.0000   1.0000</span></span>
<span><span class="co">#&gt; Pos Pred Value         1.0000   1.0000   1.0000</span></span>
<span><span class="co">#&gt; Neg Pred Value         1.0000   1.0000   1.0000</span></span>
<span><span class="co">#&gt; Prevalence             0.2895   0.3158   0.3947</span></span>
<span><span class="co">#&gt; Detection Rate         0.2895   0.3158   0.3947</span></span>
<span><span class="co">#&gt; Detection Prevalence   0.2895   0.3158   0.3947</span></span>
<span><span class="co">#&gt; Balanced Accuracy      1.0000   1.0000   1.0000</span></span></code></pre></div>
<p>The polynomials obtain the same results as the original NN.</p>
<p>Then, we can extract a diagonal plot for each of the polynomials
obtained, in total
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>3</mn><annotation encoding="application/x-tex">3</annotation></semantics></math>
diagonal plots.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span></span>
<span>    <span class="fu">nn2poly</span><span class="fu">:::</span><span class="fu"><a href="../reference/plot_diagonal.html">plot_diagonal</a></span><span class="op">(</span>x_axis <span class="op">=</span>  <span class="va">prediction_NN</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,</span>
<span>                  y_axis <span class="op">=</span>  <span class="va">prediction_poly_matrix</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,</span>
<span>                  xlab <span class="op">=</span> <span class="st">"NN prediction"</span>,</span>
<span>                  ylab <span class="op">=</span> <span class="st">"Polynomial prediction"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="includes%2Fnn2poly-03-class-diagonal-plot-1.png"><img src="includes%2Fnn2poly-03-class-diagonal-plot-2.png"><img src="includes%2Fnn2poly-03-class-diagonal-plot-3.png"></p>
<p>We can observe how all the polynomials obtain quite similar
predictions to their equivalent NN predictions.</p>
<p>We can also plot the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
most important coefficients in absolute value to compare which variables
or interactions are more relevant in each polynomial. In this case, we
will have 3 plots for each NN again, one per polynomial at each output
neuron. In this case, the obtained coefficients will represent the most
important variables when assigning the probability to be in each
class.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">final_poly</span>, n <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<p><img src="includes%2Fnn2poly-03-class-n-important-1.png"></p>
<blockquote>
<p><em>Note</em>: The coefficients values are not in the same scale as
the original polynomial due to the fact that we have scaled all the data
before training, even the response variable Y. Furthermore, as data has
been scaled to the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mo>−</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[-1,1]</annotation></semantics></math>
interval, interactions of order 2 or higher would usually need a higher
absolute value than the lower order coefficients to be more relevant</p>
</blockquote>
<p>Finally, the problem with Taylor expansion can be checked with the
following plots, where each layer is represented with their activation
function, its Taylor expansion, the error and also the density of the
activation potentials that the activation functions receives at that
layer.</p>
<p>It can be clearly seen with the activation potentials density, in
green, that it is kept close to zero, thus having an accurate Taylor
expansion around zero at each hidden layer.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nn2poly</span><span class="fu">:::</span><span class="fu"><a href="../reference/plot_taylor_and_activation_potentials.html">plot_taylor_and_activation_potentials</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">nn</span>,</span>
<span>                                                data <span class="op">=</span> <span class="va">train</span>,</span>
<span>                                                max_order <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                                constraints <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<p><img src="includes%2Fnn2poly-03-class-potentials-1.png"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span></code></pre>
<p><img src="includes%2Fnn2poly-03-class-potentials-2.png"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span></code></pre>
<p><img src="includes%2Fnn2poly-03-class-potentials-3.png"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pablo Morala, Iñaki Ucar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
